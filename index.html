<!DOCTYPE html><html lang="en"><head>    <meta charset="UTF-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>Legion Command Center</title>    <link rel="preconnect" href="https://fonts.googleapis.com">    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&family=Roboto+Mono&display=swap" rel="stylesheet">    <style>        :root {            --theme-red: #C70039;            --theme-black: #000000;            --theme-white: #FFFFFF;            --theme-gray: #888888;        }        body {            background-color: var(--theme-white);            color: var(--theme-black);            font-family: 'Roboto Mono', monospace;            font-size: 16px;            margin: 0;            padding: 0;            overflow-x: hidden;        }        #bg-canvas {            position: fixed;            top: 0;            left: 0;            width: 100%;            height: 100%;            z-index: -1;            opacity: 0.1;        }        .pixel-border {            border: 4px solid var(--theme-black);            box-shadow: 0 0 0 4px var(--theme-white), 0 0 0 8px var(--theme-black);            background-color: var(--theme-white);        }        .pixel-border-inner {            border: 2px solid var(--theme-black);        }        .nav-item {            color: var(--theme-black);            border: 2px solid transparent;            font-family: 'VT323', monospace;            padding: 0.5rem 1rem;            cursor: pointer;            transition: background-color 0.2s;        }        .nav-item.active {            background-color: var(--theme-red);            color: var(--theme-white);            border-color: var(--theme-black);        }        .nav-item:hover:not(.active) {            background-color: #FDD;        }        .content-module {            display: none;            padding: 1rem;        }        .content-module.active {            display: block;            animation: scanlines 0.5s forwards;        }        @keyframes scanlines {            0% { opacity: 0; transform: translateY(10px); }            100% { opacity: 1; transform: translateY(0); }        }        #main-content {            animation: crt-brightness-flicker 6s infinite;        }        @keyframes crt-brightness-flicker {            0%, 96%, 100% { opacity: 1; }            96.5% { opacity: 0.92; }            97% { opacity: 0.95; }        }        .terminal-card {            border: 2px solid var(--theme-black);            padding: 1rem;            margin-bottom: 1rem;        }
        /* Onboarding Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .modal-overlay.hidden {
            display: none;
        }
        .onboarding-card {
            background-color: var(--theme-white);
            border: 4px solid var(--theme-black);
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            position: relative;
            box-shadow: 10px 10px 0px var(--theme-black);
        }
        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--theme-black);
            padding-bottom: 1rem;
        }
        .step {
            font-family: 'Press Start 2P', cursive;
            font-size: 0.7rem;
            color: var(--theme-gray);
        }
        .step.active {
            color: var(--theme-red);
        }
        .selection-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin: 1.5rem 0;
        }
        .selection-option {
            border: 2px solid var(--theme-black);
            padding: 1rem;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
            font-family: 'VT323', monospace;
            font-size: 1.2rem;
        }
        .selection-option:hover {
            transform: translate(-2px, -2px);
            box-shadow: 4px 4px 0 var(--theme-black);
        }
        .selection-option.selected {
            background-color: var(--theme-black);
            color: var(--theme-white);
            border-color: var(--theme-red);
        }

        .ai-button {
            background-color: var(--theme-red);
            color: var(--theme-white);
            font-family: 'Press Start 2P', cursive;
            padding: 0.5rem 1rem;
            border: 2px solid var(--theme-black);
            cursor: pointer;
        }        .ai-button:hover {            background-color: var(--theme-black);            color: var(--theme-red);        }        textarea, input[type="text"] {            width: 100%;            border: 2px solid var(--theme-black);            padding: 0.5rem;            margin: 0.5rem 0;        }        @media (max-width: 640px) {            body { font-size: 14px; }            .nav-item { padding: 0.25rem 0.5rem; }            #bg-canvas { display: none; }            .pixel-border { box-shadow: none; border: 2px solid var(--theme-black); }        }    </style></head><body class="starfield">    <canvas id="bg-canvas" aria-hidden="true"></canvas>

    <!-- Onboarding Modal -->
    <div id="onboarding-modal" class="modal-overlay hidden">
        <div class="onboarding-card">
            <h2 style="color: var(--theme-red); font-family: 'Press Start 2P', cursive; text-align: center; margin-bottom: 2rem;">INITIALIZE SYSTEM</h2>

            <div class="step-indicator">
                <span class="step active" id="step-1-indicator">1. ROLE</span>
                <span class="step" id="step-2-indicator">2. STYLE</span>
                <span class="step" id="step-3-indicator">3. THEME</span>
            </div>

            <!-- Step 1: Role -->
            <div id="step-1" class="onboarding-step">
                <p style="text-align: center; font-family: 'VT323'; font-size: 1.5rem;">SELECT DESIGNATION</p>
                <div class="selection-grid">
                    <div class="selection-option" onclick="selectRole('coach', this)">
                        <h3>COACH</h3>
                        <p>Command the legion. Build strategies.</p>
                    </div>
                    <div class="selection-option" onclick="selectRole('client', this)">
                        <h3>CLIENT</h3>
                        <p>Execute the mission. Level up.</p>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 2rem;">
                    <button class="ai-button" onclick="nextStep(2)">CONFIRM</button>
                </div>
            </div>

            <!-- Step 2: Gamification Style -->
            <div id="step-2" class="onboarding-step" style="display: none;">
                <p style="text-align: center; font-family: 'VT323'; font-size: 1.5rem;">SELECT SIMULATION STYLE</p>
                <div class="selection-grid" style="grid-template-columns: 1fr 1fr 1fr;">
                    <div class="selection-option" onclick="selectStyle('sports', this)">
                        <h3>SPORTS</h3>
                        <p>Boxing, Hockey, etc.</p>
                    </div>
                    <div class="selection-option" onclick="selectStyle('rpg', this)">
                        <h3>RPG</h3>
                        <p>Fantasy, Adventure</p>
                    </div>
                    <div class="selection-option" onclick="selectStyle('platformer', this)">
                        <h3>PLATFORM</h3>
                        <p>Jump & Run</p>
                    </div>
                    <div class="selection-option" onclick="selectStyle('fps', this)">
                        <h3>FPS</h3>
                        <p>Tactical Shooter</p>
                    </div>
                    <div class="selection-option" onclick="selectStyle('strategy', this)">
                        <h3>RTS</h3>
                        <p>Command & Conquer</p>
                    </div>
                    <div class="selection-option" onclick="selectStyle('racing', this)">
                        <h3>RACING</h3>
                        <p>High Speed</p>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 2rem;">
                    <button class="ai-button" onclick="nextStep(3)">CONFIRM</button>
                </div>
            </div>

            <!-- Step 3: Theme -->
            <div id="step-3" class="onboarding-step" style="display: none;">
                <p style="text-align: center; font-family: 'VT323'; font-size: 1.5rem;">DEFINE VISUAL THEME</p>
                <textarea id="theme-input" rows="3" placeholder="e.g., Cyberpunk 2077, Medieval Fantasy, 8-bit Retro..."></textarea>
                <div style="text-align: center; margin-top: 2rem;">
                    <button class="ai-button" onclick="finishOnboarding()">INITIALIZE</button>
                </div>
            </div>
        </div>
    </div>

    <div class="flex flex-col max-w-5xl mx-auto pixel-border">        <nav id="main-nav" class="p-2 border-b-4 border-black sm:border-r-4 sm:w-48">            <h1 style="color: var(--theme-red); font-family: 'Press Start 2P', cursive; font-size: 1.5rem; display: none sm:block;">COMMAND</h1>            <div class="flex flex-row sm:flex-col gap-2">                <button class="nav-item active" data-target="dashboard">DASHBOARD</button>                <button class="nav-item" data-target="strategy-forge">STRATEGY FORGE</button>                <button class="nav-item" data-target="intel-map">INTEL MAP</button>                <button class="nav-item" data-target="training-sim">TRAINING SIM</button>                <button class="nav-item" data-target="field-manual">FIELD MANUAL</button>            </div>        </nav>        <main id="main-content" class="p-4" style="max-height: 85vh; overflow-y: auto;" aria-live="polite">            <section id="dashboard" class="content-module active">                <h2 style="color: var(--theme-red); font-family: 'Press Start 2P', cursive; font-size: 2rem;">SYSTEM ONLINE</h2>                <p>Welcome, Commander. This is your hub for a digital fitness empire.</p>            </section>            <section id="strategy-forge" class="content-module">                <h2 style="color: var(--theme-red); font-family: 'Press Start 2P', cursive; font-size: 2rem;">STRATEGY FORGE</h2>                <div id="terminal-hub" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2">                    <div class="terminal-card" data-terminal="foundation">                        <h3 style="color: var(--theme-red); font-family: 'Press Start 2P', cursive;">HERO CLASS</h3>                        <p>Define your core warrior archetype.</p>                    </div>                    <div class="terminal-card" data-terminal="monetization">                        <h3 style="color: var(--theme-red); font-family: 'Press Start 2P', cursive;">LOOT TABLE</h3>                        <p>Define your initial offerings.</p>                    </div>                </div>                <div id="terminal-content"></div>            </section>            <section id="intel-map" class="content-module">                <h2 style="color: var(--theme-red); font-family: 'Press Start 2P', cursive; font-size: 2rem;">INTEL MAP</h2>                <p>Visual intelligence on key models.</p>            </section>            <section id="training-sim" class="content-module">                <h2 style="color: var(--theme-red); font-family: 'Press Start 2P', cursive; font-size: 2rem;">TRAINING SIMULATOR</h2>                <p>Test your strategic knowledge.</p>            </section>            <section id="field-manual" class="content-module">                <h2 style="color: var(--theme-red); font-family: 'Press Start 2P', cursive; font-size: 2rem;">FIELD MANUAL</h2>                <p>Access strategic reports.</p>            </section>        </main>    </div>    <script>
        // Onboarding State
        const onboardingState = {
            role: null,
            style: null,
            theme: null
        };

        function selectRole(role, element) {
            onboardingState.role = role;
            document.querySelectorAll('#step-1 .selection-option').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
        }

        function selectStyle(style, element) {
            onboardingState.style = style;
            document.querySelectorAll('#step-2 .selection-option').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
        }

        function nextStep(step) {
            if (step === 2 && !onboardingState.role) return alert('SELECT ROLE FIRST');
            if (step === 3 && !onboardingState.style) return alert('SELECT STYLE FIRST');

            document.querySelectorAll('.onboarding-step').forEach(el => el.style.display = 'none');
            document.getElementById(`step-${step}`).style.display = 'block';

            document.querySelectorAll('.step').forEach(el => el.classList.remove('active'));
            document.getElementById(`step-${step}-indicator`).classList.add('active');
        }

        async function finishOnboarding() {
            onboardingState.theme = document.getElementById('theme-input').value;
            if (!onboardingState.theme) return alert('DEFINE THEME');

            console.log('Onboarding Complete:', onboardingState);

            // Prepare payload for backend
            const payload = {
                role: onboardingState.role,
                gamificationStyle: onboardingState.style,
                gamificationTheme: onboardingState.theme
            };

            // Attempt to save to backend
            try {
                const token = localStorage.getItem('token'); // Assuming auth token is stored here
                if (token) {
                    const response = await fetch('/api/v1/users/onboarding', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        console.error('Failed to save onboarding to backend');
                    }
                } else {
                    console.warn('No auth token found, skipping backend save');
                }
            } catch (error) {
                console.error('Error saving onboarding:', error);
            }

            // Save to local storage for immediate UI update/persistence in prototype
            localStorage.setItem('legion_onboarding_completed', 'true');
            localStorage.setItem('legion_preferences', JSON.stringify(onboardingState));

            document.getElementById('onboarding-modal').classList.add('hidden');
            playBeep();
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Check Onboarding Status
            if (!localStorage.getItem('legion_onboarding_completed')) {
                document.getElementById('onboarding-modal').classList.remove('hidden');
            }

            // --- Background Canvas ---            const canvas = document.getElementById('bg-canvas');            const ctx = canvas.getContext('2d');            if (ctx) {                function resizeCanvas() {                    canvas.width = window.innerWidth;                    canvas.height = window.innerHeight;                }                resizeCanvas();                window.addEventListener('resize', resizeCanvas);                const stars = Array(50).fill().map(() => ({                    x: Math.random() * canvas.width,                    y: Math.random() * canvas.height,                    size: Math.random() * 2 + 1,                    speed: Math.random() * 0.2 + 0.1                }));                function drawStars() {                    ctx.clearRect(0, 0, canvas.width, canvas.height);                    ctx.fillStyle = '#C70039';                    stars.forEach(star => {                        ctx.fillRect(star.x, star.y, star.size, star.size);                        star.y += star.speed;                        if (star.y > canvas.height) star.y = 0;                    });                    requestAnimationFrame(drawStars);                }                drawStars();            }            // --- Sound Effects ---            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();            function playBeep() {                const oscillator = audioCtx.createOscillator();                oscillator.type = 'square';                oscillator.frequency.setValueAtTime(440, audioCtx.currentTime);                oscillator.connect(audioCtx.destination);                oscillator.start();                oscillator.stop(audioCtx.currentTime + 0.1);            }
            // Make playBeep global for onboarding
            window.playBeep = playBeep;

            // --- Navigation ---            const navItems = document.querySelectorAll('.nav-item');            const contentModules = document.querySelectorAll('.content-module');            navItems.forEach(item => {                item.addEventListener('click', () => {                    if (item.classList.contains('active')) return;                    navItems.forEach(i => i.classList.remove('active'));                    item.classList.add('active');                    contentModules.forEach(module => {                        module.classList.remove('active');                        if (module.id === item.dataset.target) module.classList.add('active');                    });                    playBeep();                });            });            // --- Terminal Hub ---            const terminalCards = document.querySelectorAll('.terminal-card');            const terminalContent = document.getElementById('terminal-content');            const terminalTemplates = {                foundation: `                    <div class="terminal-card">                        <h3 style="color: var(--theme-red); font-family: 'Press Start 2P', cursive;">HERO CLASS</h3>                        <p>Define your hero.</p>                        <textarea id="foundation-input" rows="3" placeholder="e.g., High-stress tech worker..."></textarea>                        <button class="ai-button" id="foundation-query">QUERY ORACLE</button>                        <div id="foundation-results" class="mt-2"></div>                    </div>                `,                monetization: `                    <div class="terminal-card">                        <h3 style="color: var(--theme-red); font-family: 'Press Start 2P', cursive;">LOOT TABLE</h3>                        <p>Define your offerings.</p>                        <textarea id="monetization-input" rows="3" placeholder="e.g., Free Relic: PDF guide..."></textarea>                        <button class="ai-button" id="monetization-query">QUERY ORACLE</button>                        <div id="monetization-results" class="mt-2"></div>                    </div>                `            };            terminalCards.forEach(card => {                card.addEventListener('click', () => {                    terminalContent.innerHTML = terminalTemplates[card.dataset.terminal];                    document.querySelectorAll('.ai-button').forEach(btn => {                        btn.addEventListener('click', () => {                            const inputId = btn.id.replace('-query', '-input');                            const resultId = btn.id.replace('-query', '-results');                            const input = document.getElementById(inputId).value;                            if (!input) {                                document.getElementById(resultId).innerHTML = '<p style="color: var(--theme-red);">INPUT REQUIRED.</p>';                                return;                            }                            document.getElementById(resultId).innerHTML = '<p>Loading...</p>';                            setTimeout(() => {                                document.getElementById(resultId).innerHTML = `                                    <p>Result for: ${input}</p>                                    <p>Output: Strategic plan generated!</p>                                `;                                playBeep();                            }, 1000); // Mock API                        });                    });                    playBeep();                });            });        });    </script></body></html>